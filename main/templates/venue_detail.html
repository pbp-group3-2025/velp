{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<p><a href="{% url 'main:show_main' %}"><button>‚Üê Back to Venue List</button></a></p>

<h1>{{ venue.name }}</h1>

<p><b>City:</b> {{ venue.CityName }}</p>
<p><b>Street:</b> {{ venue.StreetName }}</p>
<p><b>Leisure:</b> {{ venue.leisure }}</p>

<p><b>Price per hour:</b>
  {% if venue.price_per_hour %}
    Rp {{ venue.price_per_hour|intcomma }}
  {% else %}
    (price not set)
  {% endif %}
</p>

{% if user.is_authenticated %}
  <p>
    <a href="{% url 'main:create_booking' venue.id %}">
      <button>Book Now</button>
    </a>
  </p>
{% else %}
  <p>
    <a href="{% url 'main:login' %}?next={% url 'main:create_booking' venue.id %}">
      <button>Login to Book</button>
    </a>
  </p>
{% endif %}

<p>Report this venue?</p>
{% if user.is_authenticated %}
    {% include "reports/report_button.html" with obj=venue target_type="venue" %}
{% endif %}

<div id="reviewsContainer">
  {% for review in venue.reviews.all %}
    <hr>

    <p><strong>{{ review.user.username }}</strong> : {{ review.average_rating }}/5</p>
    <p>Accessibility: {{ review.accessibility }}/5</p>
    <p>Facility: {{ review.facility }}/5</p>
    <p>Value for money: {{ review.value_for_money }}/5</p>
    <p>Comment : {{ review.comment }}</p>

    {% if review.user == request.user %}
      
      <!-- DELETE -->
      <button 
        type="button"
        class="btn btn-danger btn-sm deleteReviewBtn"
        data-id="{{ review.id }}"
        data-url="{% url 'review:delete_review' review.id %}">
        Delete 
      </button>

      <!-- EDIT AJAX -->
      <button 
        type="button"
        class="btn btn-warning btn-sm editReviewBtn"
        data-id="{{ review.id }}"
        data-accessibility="{{ review.accessibility }}"
        data-facility="{{ review.facility }}"
        data-vfm="{{ review.value_for_money }}"
        data-comment="{{ review.comment }}"
        data-url="{% url 'review:edit_review_ajax' review.id %}">
        Edit (AJAX)
      </button>

    {% endif %}

    <p>Report this review?</p>
    {% if user.is_authenticated %}
      {% include "reports/report_button.html" with obj=review target_type="review" %}
    {% endif %}

  {% empty %}
    <p>No review at the moment.</p>
  {% endfor %}
</div>

<hr>

<button type="button" 
        class="btn btn-success mb-4" 
        id="openAddReviewBtn">
  Add a review by AJAX
</button>

{% include "review/modal_review.html" %}

{% endblock content %}

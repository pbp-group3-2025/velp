{% extends "base.html" %}
{% block title %}Community Groups{% endblock %}

{% block content %}
<p><a href="{% url 'main:show_main' %}"><button>← Back to Venue List</button></a></p>
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="h5 mb-0">Find, join & discuss with football groups</h2>
  <a class="btn btn-primary btn-sm" href="{% url 'community:create_group' %}">+ New Group</a>
</div>

<div class="row g-3">
  {% for g in groups %}
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div class="card-body d-flex justify-content-between align-items-start">
          <div>
            <h3 class="h6 mb-1">{{ g.name }}</h3>
            {% if g.description %}
              <p class="text-muted small mb-2">{{ g.description|truncatechars:140 }}</p>
            {% endif %}
            <span class="badge text-bg-light">{{ g.posts.count }} posts</span>
          </div>

          <div class="d-flex gap-2">
            <a class="btn btn-primary btn-sm" href="{% url 'community:group_detail' g.slug %}">Open</a>

            {% if request.user.is_authenticated and request.user.id == g.owner_id %}
              <a class="btn btn-outline-warning btn-sm" href="{% url 'community:edit_group' g.slug %}">Edit</a>

              <button type="button"
                      class="btn btn-outline-danger btn-sm"
                      data-bs-toggle="modal"
                      data-bs-target="#confirmModal"
                      data-action="{% url 'community:delete_group' g.slug %}"
                      data-title="Delete group"
                      data-body="Delete this group? This action can’t be undone."
                      data-redirect="{% url 'community:group_list' %}">
                Delete
              </button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% empty %}
    <div class="col-12">
      <div class="alert alert-light border">No groups yet. Create the first one!</div>
    </div>
  {% endfor %}
</div>
{% endblock %}
